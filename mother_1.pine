// === The Mother Strategy â€“ Phase 1: Foundation Scaffold ===
// Bullish-only | Setup Classification + Global Inputs + EMA Plotting + Debug Labels

//@version=5
strategy("The Mother (Phase 1)", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// === GLOBAL INPUTS ===
contractSize    = input.int(1, "Contract Size")
tradeDirection  = input.string("Long", "Trade Direction", options=["Long"], tooltip="Only bullish logic supported in Phase 1")
showDebugLabels = input.bool(true, "Show Debug Labels")

// === TRADING SESSION CONTROL ===
session1_start = input.time(timestamp("0000-01-01T08:00:00"), "Session 1 Start")
session1_end   = input.time(timestamp("0000-01-01T11:00:00"), "Session 1 End")
session2_start = input.time(timestamp("0000-01-01T13:00:00"), "Session 2 Start")
session2_end   = input.time(timestamp("0000-01-01T17:00:00"), "Session 2 End")

inSession = (time >= session1_start and time <= session1_end) or (time >= session2_start and time <= session2_end)

// === EMA STRUCTURE ===
ema10  = ta.ema(close, 10)
ema20  = ta.ema(close, 20)
ema50  = ta.ema(close, 50)
ema100 = ta.ema(close, 100)
ema200 = ta.ema(close, 200)

plot(ema10,  "EMA 10",  color=color.blue)
plot(ema20,  "EMA 20",  color=color.red)
plot(ema50,  "EMA 50",  color=color.gray)
plot(ema100, "EMA 100", color=color.purple)
plot(ema200, "EMA 200", color=color.orange)

// === WEEKLY SETUP CLASSIFICATION ===
// A: last weekly bar closed above the open of the previous red candle
w_open1  = request.security(syminfo.tickerid, "W", open[1])
w_close1 = request.security(syminfo.tickerid, "W", close[1])
w_open2  = request.security(syminfo.tickerid, "W", open[2])
w_close2 = request.security(syminfo.tickerid, "W", close[2])

isPrevWeeklyRed = w_close2 < w_open2
weeklyRating = isPrevWeeklyRed and w_close1 > w_open2 ? "A" : "B"

// === DAILY BIAS CLASSIFICATION ===
// 3 states: Momentum, Retracement, Reaction
// Momentum: daily close > open of last red OR > close of last green
// Retracement: daily close > open of last green (but not meeting momentum)
// Reaction: daily close < open of last green

d_open1  = request.security(syminfo.tickerid, "D", open[1])
d_close1 = request.security(syminfo.tickerid, "D", close[1])
d_open2  = request.security(syminfo.tickerid, "D", open[2])
d_close2 = request.security(syminfo.tickerid, "D", close[2])

isPrevDailyRed   = d_close2 < d_open2
isPrevDailyGreen = d_close2 > d_open2

var string dailyBias = ""
if isPrevDailyRed and d_close1 > d_open2 or isPrevDailyGreen and d_close1 > d_close2
    dailyBias := "Momentum"
else if d_close1 > d_open2
    dailyBias := "Retracement"
else
    dailyBias := "Reaction"

// === DEBUG LABELS ===
if showDebugLabels and inSession and bar_index % 10 == 0
    label.new(bar_index, high, text = "Weekly: " + weeklyRating + "\nDaily: " + dailyBias,
              style=label.style_label_down, color=color.yellow, textcolor=color.black)

// === LOGIC SPECIFICATIONS ===
// 1. EMAs plotted for visual structure
// 2. Weekly A if last week closed above open of previous red bar; else B
// 3. Daily Bias: 
//    - Momentum if today closed above last red open OR above last green close
//    - Retracement if closed above last green open but not momentum
//    - Reaction if closed below last green open
// 4. Debug labels show weeklyRating and dailyBias on chart when enabled
// 5. Session filter applied, no entries yet
