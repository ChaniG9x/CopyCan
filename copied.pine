//@version=5
indicator("Multi-Timeframe T2 Labels", overlay=true)

// EMA lengths and calculations
emaLen10  = 10
emaLen20  = 20
emaLen200 = 200

ema10  = ta.ema(close, emaLen10)
ema20  = ta.ema(close, emaLen20)
ema200 = ta.ema(close, emaLen200)

// Plot EMAs
plot(ema10,  title="EMA 10",  color=color.blue)
plot(ema20,  title="EMA 20",  color=color.red)
plot(ema200, title="EMA 200", color=color.orange)

// Condition for T2 label (EMA alignment and bullish candle crossing EMA10)
emaTrendOk = (ema10 > ema20) and (ema20 > ema200)
crosses(emaVal) =>
    (low < emaVal) and (high > emaVal)

var bool previousDayT2 = na
var bool previous4HT2 = na
var bool previous1HT2 = na

// Check if the previous daily candle had a T2 label
if timeframe.isdaily
    previousDayT2 := (emaTrendOk and (close > open)) // Example of T2 condition

// Check if the previous 4-hour candle had a T2 label
if timeframe.isminutes and timeframe.multiplier == 240 // For 4H timeframe
    previous4HT2 := (emaTrendOk and (close > open)) // Example of T2 condition on 4H

// Check if the previous 1-hour candle had a T2 label
if timeframe.isminutes and timeframe.multiplier == 60 // For 1H timeframe
    previous1HT2 := (emaTrendOk and (close > open)) // Example of T2 condition on 1H

// Plot labels on different timeframes based on the conditions above

// **For 1H and 4H labels:**
if timeframe.isminutes and timeframe.multiplier == 60 and previousDayT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)

if timeframe.isminutes and timeframe.multiplier == 240 and previousDayT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)

// **For 15m and 1m labels based on 4H:**
if timeframe.isminutes and timeframe.multiplier == 15 and previous4HT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)

if timeframe.isminutes and timeframe.multiplier == 1 and previous4HT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)

// **For 1m and 10sec labels based on 1H:**
if timeframe.isminutes and timeframe.multiplier == 1 and previous1HT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)

if timeframe.isminutes and timeframe.multiplier == 10 and previous1HT2
    label.new(bar_index, high, "T2", color=color.green, textcolor=color.white, style=label.style_label_down)
