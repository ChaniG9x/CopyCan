//@version=5
indicator("Full Cascading Strategy", overlay=true)

// --- EMA Calculations for Each Timeframe ---
ema10 = ta.ema(close, 10)
ema20 = ta.ema(close, 20)
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)

// Plot EMAs
plot(ema10, title="EMA 10", color=color.blue, linewidth=2)
plot(ema20, title="EMA 20", color=color.red, linewidth=2)
plot(ema50, title="EMA 50", color=color.gray, linewidth=2)
plot(ema200, title="EMA 200", color=color.orange, linewidth=2)

// --- Cascading Confirmation Logic Between Timeframes ---

// Track higher timeframe's confirmation status (flags for previous candle confirmations)
var bool prevDailyConfirmed = false
var bool prev4hConfirmed = false
var bool prev1hConfirmed = false

// --- Daily Timeframe Confirmation ---
// Conditions for confirming the daily pattern
dailyConfirmed = ta.change(time("D")) and (close > open) and (close > ema10) and (close > ema20)  // Example condition

if dailyConfirmed
    prevDailyConfirmed := true

// --- 4-Hour Timeframe Confirmation ---
// Conditions for confirming the 4-hour pattern
fourHConfirmed = request.security(syminfo.tickerid, "D", prevDailyConfirmed ? 1 : 0, lookahead=barmerge.lookahead_off) == 1 and (close > open) and (close > ema10)

// Only allow 4h to search for patterns after daily confirmation
if fourHConfirmed
    prev4hConfirmed := true

// --- 1-Hour Timeframe Confirmation ---
// Conditions for confirming the 1-hour pattern
oneHConfirmed = request.security(syminfo.tickerid, "4H", prev4hConfirmed ? 1 : 0, lookahead=barmerge.lookahead_off) == 1 and (close > open) and (close > ema10)

// Only allow 1h to search for patterns after 4h confirmation
if oneHConfirmed
    prev1hConfirmed := true

// --- 15-Minute and 1-Minute Timeframe Confirmation ---
// Conditions for confirming the 15-minute and 1-minute patterns
fifteenMConfirmed = request.security(syminfo.tickerid, "1H", prev1hConfirmed ? 1 : 0, lookahead=barmerge.lookahead_off) == 1 and (close > open) and (close > ema10)

// Allow 15m and 1m to search for patterns after 1h confirmation
oneMConfirmed = fifteenMConfirmed and (close > open) and (close > ema10)  // Example pattern check

// --- 10-Second Timeframe Confirmation ---
// Conditions for confirming the 10-second pattern
tenSecConfirmed = request.security(syminfo.tickerid, "1M", oneMConfirmed ? 1 : 0, lookahead=barmerge.lookahead_off) == 1 and (close > open) and (close > ema10)

// --- Place Labels After Confirmation for Each Timeframe ---

// Daily Pattern Confirmation Label
if dailyConfirmed
    label.new(bar_index, high, "Daily Confirmed", color=color.green, textcolor=color.white, style=label.style_label_up)

// 4-Hour Pattern Confirmation Label
if fourHConfirmed
    label.new(bar_index, high, "4-Hour Confirmed", color=color.blue, textcolor=color.white, style=label.style_label_up)

// 1-Hour Pattern Confirmation Label
if oneHConfirmed
    label.new(bar_index, high, "1-Hour Confirmed", color=color.purple, textcolor=color.white, style=label.style_label_up)

// 15-Minute Pattern Confirmation Label
if fifteenMConfirmed
    label.new(bar_index, high, "15-Minute Confirmed", color=color.orange, textcolor=color.white, style=label.style_label_up)

// 1-Minute Pattern Confirmation Label
if oneMConfirmed
    label.new(bar_index, high, "1-Minute Confirmed", color=color.red, textcolor=color.white, style=label.style_label_up)

// 10-Second Pattern Confirmation Label
if tenSecConfirmed
    label.new(bar_index, high, "10-Second Confirmed", color=color.yellow, textcolor=color.white, style=label.style_label_up)
